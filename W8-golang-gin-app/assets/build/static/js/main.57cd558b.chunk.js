(this.webpackJsonprgb_frontend=this.webpackJsonprgb_frontend||[]).push([[0],{26:function(e,t,n){},27:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(19),s=n.n(r),c=n(9),a=(n(26),n(2)),o=n(1),i=n.n(o),l=(n(27),n(4)),j=n(0),b=i.a.createContext({token:null,loggedIn:!1,login:function(e){},logout:function(){}}),u=function(e){var t="rgbToken",n=Object(o.useState)(localStorage.getItem(t)),r=Object(l.a)(n,2),s=r[0],c=r[1],a={token:s,loggedIn:!!s,login:function(e){c(e),localStorage.setItem(t,e)},logout:function(){c(null),localStorage.removeItem(t)}};return Object(j.jsx)(b.Provider,{value:a,children:e.children})},d=b,p=function(){var e=Object(a.g)(),t=Object(o.useContext)(d),n=t.loggedIn;return Object(j.jsxs)("nav",{className:"navbar navbar-expand-md navbar-dark fixed-top bg-dark",children:[Object(j.jsx)("button",{type:"button",className:"navbar-toggler","data-toggle":"collapse","data-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(j.jsx)("span",{className:"navbar-toggler-icon"})}),Object(j.jsxs)("div",{className:"collapse navbar-collapse justify-content-between",id:"navbarCollapse",children:[Object(j.jsx)("div",{className:"d-flex flex-row",children:Object(j.jsxs)("ul",{className:"navbar-nav mr-auto",children:[Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(c.b,{className:"nav-link",to:"/",children:"RGB"})}),n&&Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(c.b,{className:"nav-link",to:"/posts",children:"My posts"})})]})}),Object(j.jsx)("div",{className:"d-flex flex-row justify-content-end",children:Object(j.jsxs)("ul",{className:"navbar-nav mr-auto",children:[!n&&Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(c.b,{className:"nav-link",to:"/auth",children:"Login"})}),n&&Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)("button",{className:"btn btn-dark",onClick:function(){t.logout(),e.replace("/")},children:"LOGOUT"})})]})})]})]})},O=function(e){return Object(j.jsxs)(o.Fragment,{children:[Object(j.jsx)(p,{}),Object(j.jsx)("main",{children:Object(j.jsx)("div",{className:"container",children:e.children})})]})},h=function(){return Object(j.jsx)("section",{children:Object(j.jsx)("h1",{children:"Welcome to React Gin Blog!"})})},x=function(){return Object(j.jsx)(h,{})},f=n(7),m=n.n(f),g=n(10),v=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var s=r[n];t.push(e[s])}return Object(j.jsx)("div",{className:"mt-3",children:t.map((function(e){return Object(j.jsx)("p",{className:"alert alert-danger",children:e})}))})},k=function(){var e=Object(a.g)(),t=Object(o.useRef)(),n=Object(o.useRef)(),r=Object(o.useContext)(d),s=Object(o.useState)(!0),c=Object(l.a)(s,2),i=c[0],b=c[1],u=Object(o.useState)({}),p=Object(l.a)(u,2),O=p[0],h=p[1],x=i?"/api/signin":"/api/signup";function f(){return(f=Object(g.a)(m.a.mark((function s(c){var a,o,l,j,b;return m.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return c.preventDefault(),h({}),a=t.current.value,o=n.current.value,s.prev=4,s.next=7,fetch(x,{method:"POST",body:JSON.stringify({Username:a,Password:o}),headers:{"Content-Type":"application/json"}});case 7:return l=s.sent,s.next=10,l.json();case 10:if(j=s.sent,l.ok){s.next=18;break}if(b=i?"Login failed":"Sign up failed",j.hasOwnProperty("error")){s.next=15;break}throw new Error(b);case 15:"string"===typeof j.error?h({unknown:j.error}):h(j.error),s.next=20;break;case 18:r.login(j.jwt),e.replace("/");case 20:s.next=25;break;case 22:s.prev=22,s.t0=s.catch(4),h({error:s.t0.message});case 25:case"end":return s.stop()}}),s,null,[[4,22]])})))).apply(this,arguments)}var k=i?"Login":"Sign up",w=i?"Login":"Create account",N=i?"Create new account":"Login with existing account",y=0===Object.keys(O).length?null:v(O);return Object(j.jsxs)("section",{children:[Object(j.jsx)("h1",{className:"text-center",children:k}),Object(j.jsxs)("div",{className:"container w-50",children:[Object(j.jsxs)("form",{onSubmit:function(e){return f.apply(this,arguments)},children:[Object(j.jsxs)("div",{className:"form-group pb-3",children:[Object(j.jsx)("label",{htmlFor:"username",children:"Username"}),Object(j.jsx)("input",{id:"username",type:"text",className:"form-control",required:!0,ref:t})]}),Object(j.jsxs)("div",{className:"form-group pb-3",children:[Object(j.jsx)("label",{htmlFor:"password",children:"Password"}),Object(j.jsx)("input",{id:"password",type:"password",className:"form-control",required:!0,ref:n})]}),Object(j.jsxs)("div",{className:"pt-3 d-flex justify-content-between",children:[Object(j.jsx)("button",{type:"submit",className:"btn btn-success",children:w}),Object(j.jsx)("button",{type:"button",className:"btn btn-link",onClick:function(){b((function(e){return!e})),h({})},children:N})]})]}),y]})]})},w=function(){return Object(j.jsx)(k,{})},N=n(21),y=function(e){var t=Object(o.useContext)(d),n=Object(o.useState)(""),r=Object(l.a)(n,2),s=r[0],c=r[1],a=Object(o.useState)(""),i=Object(l.a)(a,2),b=i[0],u=i[1],p=Object(o.useState)({}),O=Object(l.a)(p,2),h=O[0],x=O[1],f=Object(o.useCallback)((function(){e.post&&(c(e.post.Title),u(e.post.Content))}),[e.post]);function k(){return(k=Object(g.a)(m.a.mark((function n(r){var a,o,i,l;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.preventDefault(),x({}),n.prev=2,a=e.onEditPost?"PUT":"POST",o={Title:s,Content:b},e.onEditPost&&(o.ID=e.post.ID),n.next=8,fetch("api/posts",{method:a,body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.token}});case 8:return i=n.sent,n.next=11,i.json();case 11:if(l=n.sent,i.ok){n.next=19;break}if("Failed to add new post.",l.hasOwnProperty("error")){n.next=16;break}throw new Error("Failed to add new post.");case 16:"string"===typeof l.error?x({unknown:l.error}):x(l.error),n.next=23;break;case 19:c(""),u(""),e.onAddPost&&e.onAddPost(l.data),e.onEditPost&&e.onEditPost(l.data);case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(2),x({error:n.t0.message});case 28:case"end":return n.stop()}}),n,null,[[2,25]])})))).apply(this,arguments)}Object(o.useEffect)((function(){f()}),[f]);var w=0===Object.keys(h).length?null:v(h),N=e.onEditPost?"Update Post":"Add Post";return Object(j.jsx)("section",{children:Object(j.jsxs)("div",{className:"container w-75 pb-4",children:[Object(j.jsxs)("form",{onSubmit:function(e){return k.apply(this,arguments)},children:[Object(j.jsxs)("div",{className:"form-group pb-3",children:[Object(j.jsx)("label",{htmlFor:"title",children:"Title"}),Object(j.jsx)("input",{id:"title",type:"text",className:"form-control",required:!0,value:s,onChange:function(e){c(e.target.value)}})]}),Object(j.jsxs)("div",{className:"form-group pb-3",children:[Object(j.jsx)("label",{htmlFor:"content",children:"Content"}),Object(j.jsx)("textarea",{id:"content",className:"form-control",rows:"5",required:!0,value:b,onChange:function(e){u(e.target.value)}})]}),Object(j.jsx)("button",{type:"submit",className:"btn btn-success",children:N})]}),w]})})},P=function(e){var t=Object(o.useState)(!1),n=Object(l.a)(t,2),r=n[0],s=n[1],c=Object(o.useState)({}),a=Object(l.a)(c,2),i=a[0],b=a[1],u=Object(o.useContext)(d),p=function(){s((function(e){return!e})),b({})};function O(){return h.apply(this,arguments)}function h(){return(h=Object(g.a)(m.a.mark((function t(){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("api/posts/"+e.post.ID,{method:"DELETE",headers:{Authorization:"Bearer "+u.token}});case 3:return n=t.sent,t.next=6,n.json();case 6:if(r=t.sent,n.ok){t.next=14;break}if("Failed to add new post.",r.hasOwnProperty("error")){t.next=11;break}throw new Error("Failed to add new post.");case 11:"string"===typeof r.error?b({unknown:r.error}):b(r.error),t.next=15;break;case 14:e.onDeletePost(e.post.ID);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),b({error:t.t0.message});case 20:case"end":return t.stop()}}),t,null,[[0,17]])})))).apply(this,arguments)}var x=r?"Edit post":e.post.Title,f=r?Object(j.jsx)(y,{post:e.post,onEditPost:function(){s(!1),e.onEditPost()},editing:!0}):e.post.Content,k=r?"Cancel":"Edit",w=Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("button",{type:"button",className:"btn btn-link",onClick:p,children:k}),Object(j.jsx)("button",{type:"button",className:"btn btn-danger float-right mx-3",onClick:O,children:"Delete"})]}),N=0===Object.keys(i).length?null:v(i);return Object(j.jsxs)("div",{className:"card mb-5 pb-2",children:[Object(j.jsx)("div",{className:"card-header",children:x}),Object(j.jsx)("div",{className:"card-body",children:f}),w,N]})},C=function(e){return Object(j.jsx)("ul",{children:e.posts.map((function(t){return Object(j.jsx)(P,{onEditPost:e.onEditPost,onDeletePost:e.onDeletePost,post:t},t.ID)}))})},E=function(){var e=Object(o.useContext)(d),t=Object(o.useState)([]),n=Object(l.a)(t,2),r=n[0],s=n[1],c=Object(o.useState)({}),a=Object(l.a)(c,2),i=a[0],b=a[1],u=Object(o.useCallback)(Object(g.a)(m.a.mark((function t(){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b({}),t.prev=1,t.next=4,fetch("/api/posts",{headers:{Authorization:"Bearer "+e.token}});case 4:return n=t.sent,t.next=7,n.json();case 7:if(r=t.sent,n.ok){t.next=15;break}if("Fetching posts failed.",r.hasOwnProperty("error")){t.next=12;break}throw new Error("Fetching posts failed.");case 12:"string"===typeof r.error?b({unknown:r.error}):b(r.error),t.next=16;break;case 15:s(r.data);case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(1),b({error:t.t0.message});case 21:case"end":return t.stop()}}),t,null,[[1,18]])}))),[e.token]);Object(o.useEffect)((function(){u()}),[u]);var p=0===r.length?Object(j.jsx)("p",{children:"No posts yet"}):Object(j.jsx)(C,{posts:r,onEditPost:function(){u()},onDeletePost:function(e){s((function(t){return t.filter((function(t){return t.ID!==e}))}))}}),O=0===Object.keys(i).length?null:v(i);return Object(j.jsxs)("section",{children:[Object(j.jsx)("h1",{className:"pb-4",children:"My posts"}),Object(j.jsx)(y,{onAddPost:function(e){s((function(t){return[].concat(Object(N.a)(t),[e])}))}}),O,p]})},S=function(){return Object(j.jsx)(E,{})};var I=function(){var e=Object(o.useContext)(d);return Object(j.jsx)(O,{children:Object(j.jsxs)(a.d,{children:[Object(j.jsx)(a.b,{path:"/",exact:!0,children:Object(j.jsx)(x,{})}),!e.loggedIn&&Object(j.jsx)(a.b,{path:"/auth",children:Object(j.jsx)(w,{})}),Object(j.jsxs)(a.b,{path:"/posts",children:[e.loggedIn&&Object(j.jsx)(S,{}),!e.loggedIn&&Object(j.jsx)(a.a,{to:"/auth"})]}),Object(j.jsx)(a.b,{path:"*",children:Object(j.jsx)(a.a,{to:"/"})})]})})};s.a.render(Object(j.jsx)(u,{children:Object(j.jsx)(c.a,{children:Object(j.jsx)(I,{})})}),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.57cd558b.chunk.js.map